{% extends 'base.html' %}

{% block content %}

<script>
    function showContent(event) {
	const parent = event.target.closest('.content-window');
	const elem = event.target;
	const infoElement = parent.querySelector('.info');
	infoElement.classList.toggle("hidden");
	elem.classList.toggle('rotate-270')
    }
    function downloadFile(event) {
	jobID = window.location.href.split("/").at(-1);
	filename = `interactions.csv`;
	request_url = `/download/${jobID}/${filename}`;
	const link = document.createElement("a");
	link.href = request_url;
	link.download = `coral_interactions.csv`;
	link.click();
    }
</script>

<div id="details" class="text-lg">
    <div class="flex-col items-center justify-center content-center">
	<div>
	    <div class="info px-2 pb-2 rounded-lg">
		<div class="content-window">
		    <div class="flex text-xl border rounded-lg p-2 bg-indigo-100  mt-1 w-full text-left items-center" >
			<svg class="size-8 hover:bg-indigo-200 rounded-lg cursor-pointer" onclick="showContent(event)" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
			    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
			</svg>
			<p class="ml-2">
			Interactions by frame
			</p>
			<svg title="Download data" class="size-8 ml-auto hover:bg-indigo-200 rounded-lg cursor-pointer" onclick="downloadFile(event, {{ run.id }})" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" >
			    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
			</svg>
		    </div>
		    <div class="info p-2 text-lg border-x border-b border-dotted rounded-lg">
			{{ run.table|safe }}
		    </div>
		</div>
		<div class="content-window">
		    <div class="flex text-xl border rounded-lg p-2 bg-indigo-100  mt-1 w-full text-left items-center" >
			<svg class="size-8 hover:bg-indigo-200 rounded-lg cursor-pointer" onclick="showContent(event)" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
			    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
			</svg>
			<p class="ml-2">
			Overall interactions
			</p>
		    </div>
		    <div class="info p-2 text-lg border-x border-b border-dotted rounded-lg">
			{{ run.interaction_graph|safe }}
		    </div>
		</div>
		<div class="content-window">
		    <div class="flex text-xl border rounded-lg p-2 bg-indigo-100  mt-1 w-full text-left items-center" >
			<svg class="size-8 hover:bg-indigo-200 rounded-lg cursor-pointer" onclick="showContent(event)" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
			    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
			</svg>
			<p class="ml-2">
			Interaction map
			</p>
		    </div>
		    <div class="info p-2 text-lg border-x border-b border-dotted rounded-lg">
			{{ run.map|safe }}
		    </div>
		</div>
		<div class="content-window">
		    <div class="flex text-xl border rounded-lg p-2 bg-indigo-100  mt-1 w-full text-left items-center" >
			<svg class="size-8 hover:bg-indigo-200 rounded-lg cursor-pointer" onclick="showContent(event)" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
			    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
			</svg>
			<p class="ml-2">
			Detected ligands
			</p>
		    </div>
		    <div class="info p-2 text-lg border-x border-b border-dotted rounded-lg flex gap-2">
			{% for ligand in run.ligands %}
			<div class="bg-gray-300 w-fit p-2 rounded-lg">
			    <div class="border w-fit"> 
				{{ ligand.img|safe }}
			    </div>
			    Name: {{ ligand.name|default_if_none:"Unknown" }} <br>
			    {% if ligand.id  %}
			    ChEBI ID: <a href="https://www.ebi.ac.uk/chebi/searchId.do?chebiId=CHEBI:{{ ligand.id }}" class="hover:underline text-blue-600 inline">{{ ligand.id }}</a> <br>
			    {% else %}
			    ChEBI ID: Unknown <br>
			    {% endif %}
			    Detected in {{ ligand.frames_seen }} frame{{ ligand.frames_seen|pluralize }} <br>
			</div>
			{% endfor %}
		    </div>
		</div>
		<div class="content-window">
		    <div class="flex text-xl border rounded-lg p-2 bg-indigo-100  mt-1 w-full text-left items-center" >
			<svg class="size-8 hover:bg-indigo-200 rounded-lg cursor-pointer" onclick="showContent(event)" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
			    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
			</svg>
			<p class="ml-2">
			Protein numbering / alignment
			</p>
		    </div>
		    <div class="info p-2 text-lg border-x border-b border-dotted rounded-lg flex gap-2">
			{% for chain, data in run.alignment_scores.items %}
			<div class="pt-1">
			    <strong>Chain {{ chain }}:</strong><br>
			    <p class="ml-2">Detected entry: <a href="https://www.uniprot.org/uniprotkb/{{ data.1 }}/entry" class="text-blue-700 underline-offset-2 underline">{{ data.0 }}</a></p>
			    <p class="ml-2">E-value: {{ data.2 }}</p>
			    <br>
			</div>
			{% endfor %}
		    </div>
		</div>
	    </div>
	</div>
    </div>
</div>

{% endblock %}
