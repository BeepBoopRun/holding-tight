{% extends 'base.html' %}
{% load widget_tweaks %}
{% load static %}

{% block content %}
<details open class="mt-4 text-l rounded-lg border p-2 bg-gray-300">
    <summary class="text-2xl  cursor-pointer">How to use CORAL-MD?</summary>
    This tool processes molecular dynamics (MD) trajectories to examine how ligands interact with their protein targets. It identifies and characterizes interaction types such as hydrogen bonds, hydrophobic contacts, and aromatic stacking, and presents the results through time-resolved visualizations. Multiple uploaded simulations can be used to create a group analysis. User can choose to provide experimental data to see the correlation between experiment outcomes and simulation results. An example can be seen under <a href="/example-submission" class="text-blue-700 underline-offset-2 underline">this link</a>.
    <br>
    <br>
    To reduce possible errors, the tool is capable of automatically recognizing and removing objects other than proteins and ligands. This process is not perfect; it is recommended to provide already cleaned trajectories. 
    <br>
    <br>
    For technical details, go to the About section.
    </p>
</details>

<p class="my-4 text-xl">Please cite as...(TBD)</p>

<div class="border rounded-lg p-2 ">
    <div class="mb-4 text-xl border-b -m-2 rounded-t-lg p-2 bg-gray-300 flex flex-wrap items-center overflow-x-scroll">
	<div title="Refresh data">
	    <svg id="refreshSpinner" class="animate-[spin_2s_ease-in-out_1_forwards] cursor-pointer size-7 mx-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
		<path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
	    </svg>
	</div>
	<p class="text-2xl ml-2">Upload your simulations:</p>
	<select name="SimulationType" id="inputTypeSelect" class="h-12 ml-auto bg-gray-400/60 border rounded-lg p-2 m-2 cursor-pointer">
	    <option value="maestroDir">Maestro directory</option>
	    <option value="topTrj">Topology/Trajectory files</option>
	</select>
	<div class="border flex flex-nowrap justify-end rounded-lg items-center w-fit h-12">
	    <span id="browseButton" class="rounded-l-lg cursor-pointer bg-slate-500/60 hover:bg-slate-500/40 border-r p-2 h-full">Browse...</span>
	    <span id="filesInfo" class="bg-gray-400/60 p-2 min-w-80 max-w-150 text-nowrap h-full overflow-x-scroll">Select directory...</span>
	    <div id="clearButton" title="Clear upload" class="cursor-pointer bg-slate-500/60 hover:bg-slate-500/40 border-l h-full p-2">
		<svg class="size-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
		    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
		</svg>
	    </div>
	    <div id="confirmButton" title="Confirm upload" class="flex cursor-pointer bg-slate-500/60 hover:bg-slate-500/40 rounded-r-lg border-l h-full p-2">
		<!--
		<svg class="size-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
		    <path stroke-linecap="round" stroke-linejoin="round" d="M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3V15" />
		</svg>
		-->
		Confirm
	    </div>
	    <p id="progressNumerical" class="hidden cursor-pointer bg-slate-500/60 hover:bg-slate-500/40 rounded-r-lg border-l h-full p-2">0.00</p>
	</div>
    </div>
    <div id="simsContainer">
	{% include "submit/sims_data.html" with user_dirs=user_dirs %}
    </div>
</div>

<div class="border rounded-lg p-2 mt-3">
    <div class="mb-4 text-xl border-b -m-2 rounded-t-lg p-2 bg-gray-300 flex flex-nowrap items-center overflow-x-scroll">
	<p class=" text-2xl ml-2">Create group analysis:</p>
	<span id="addExperimentalValsBtn" title="Add experimental values to each simulation" class="ml-auto p-2 mr-2 w-85 text-center rounded-lg bg-slate-500/60 hover:bg-slate-500/40 border cursor-pointer">Add experimental values</span>
	<span id="clearQueueAnalysisBtn" class="p-2 mr-2 w-24 text-center rounded-lg bg-slate-500/60 hover:bg-slate-500/40 border cursor-pointer">Clear</span>
	<span id="queueAnalysisBtn" class="p-2 rounded-lg bg-slate-500/60 hover:bg-slate-500/40 border cursor-pointer">Submit</span>
    </div>
    <div id="analysisGroupContainer" class="grid items-stretch">
	<p class="empty-analysis-info px-2 pb-2">
	Add simulations to create the group.
	</p>
    </div>
    <p class="empty-analysis-info hidden px-2 pb-2">
    Add simulations to create the group.
    </p>
    <div class="analysis-info hidden p-2  m-0.5 text-nowrap overflow-x-scroll bg-gray-300 border">
    </div>
    <input class="value-name bg-gray-300 border hidden p-2 m-0.5 rounded" required type="text" placeholder="Value name" value="">
    <input class="value-input bg-gray-300 border hidden p-2 m-0.5 rounded" required type="number" placeholder="Enter value (required)">
    <div class="empty-cell bg-gray-300 border hidden p-2 m-0.5 rounded"></div>
</div>

<div class="border rounded-lg p-2 mt-3">
    <div class="mb-4 text-xl border-b -m-2 rounded-t-lg p-2 bg-gray-300 flex flex-nowrap items-center overflow-x-scroll">
	<p class=" text-2xl ml-2">Group analysis history:</p>
    </div>
    <div id="analysisHistoryContainer">
	{% include "submit/history.html" with history=history %}
    </div>
</div>


<button class="text-xl border rounded-lg p-2 bg-red-400 hover:bg-red-200 hover:cursor-pointer" onclick="downloadLogs(event, 'webserver.log')">
    Download webserver logs
</button>
<button class="text-xl border rounded-lg p-2 bg-red-400 hover:bg-red-200 mt-1 hover:cursor-pointer" onclick="downloadLogs(event, 'huey.log')">
    Download huey logs
</button>
{% endblock %}

{% block js_scripts %}
<script src="{% static 'resumable.js' %}"> </script>
<script src="{% static 'ligand_service/dashboard.js' %}"> </script>
{% endblock %}
